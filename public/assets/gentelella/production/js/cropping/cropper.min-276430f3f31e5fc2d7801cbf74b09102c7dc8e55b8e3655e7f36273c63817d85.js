!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t}function e(t){return"string"==typeof t}function h(t){return void 0===t}function s(t,e){var h=[];return i(e)&&h.push(e),h.slice.apply(t,h)}function a(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function o(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return!(!i||i[1]===m.protocol&&i[2]===m.hostname&&i[3]===m.port)}function r(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function n(t){return t?"rotate("+t+"deg)":"none"}function d(t){var i=U(t.degree)%180,e=(i>90?180-i:i)*Math.PI/180;return{width:t.width*_(e)+t.height*Z(e),height:t.width*Z(e)+t.height*_(e)}}function p(i,e){var h=t("<canvas>")[0],s=h.getContext("2d"),a=e.naturalWidth,o=e.naturalHeight,r=e.rotate,n=d({width:a,height:o,degree:r});return r?(h.width=n.width,h.height=n.height,s.save(),s.translate(n.width/2,n.height/2),s.rotate(r*Math.PI/180),s.drawImage(i,-a/2,-o/2,a,o),s.restore()):(h.width=a,h.height=o,s.drawImage(i,0,0,a,o)),h}function c(i,e){this.$element=t(i),this.options=t.extend({},c.DEFAULTS,t.isPlainObject(e)&&e),this.ready=!1,this.built=!1,this.cropped=!1,this.disabled=!1,this.load()}var l,g,f=t(window),u=t(document),m=window.location,v="directive",w=".cropper",x=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,b="cropper-modal",y="cropper-hide",C="cropper-hidden",$="cropper-invisible",D="cropper-move",B="cropper-crop",k="cropper-disabled",W="cropper-bg",I="mousedown touchstart",Y="mousemove touchmove",H="mouseup mouseleave touchend touchleave touchcancel",X="wheel mousewheel DOMMouseScroll",z="dblclick",L="resize"+w,T="build"+w,M="built"+w,R="dragstart"+w,E="dragmove"+w,P="dragend"+w,j={canvas:t.isFunction(t("<canvas>")[0].getContext)},O=Math.round,A=Math.sqrt,F=Math.min,N=Math.max,U=Math.abs,Z=Math.sin,_=Math.cos,S=parseFloat,q={};q.load=function(){var i,e,h,s=this,a=this.options,n=this.$element,d="";n.is("img")?h=n.prop("src"):n.is("canvas")&&j.canvas&&(h=n[0].toDataURL()),h&&(i=t.Event(T),n.one(T,a.build).trigger(i),i.isDefaultPrevented()||(a.checkImageOrigin&&o(h)&&(d=" crossOrigin",h=r(h)),this.$clone=e=t("<img"+d+' src="'+h+'">'),e.one("load",function(){var t=this.naturalWidth||e.width(),i=this.naturalHeight||e.height();s.image={naturalWidth:t,naturalHeight:i,aspectRatio:t/i,rotate:0},s.url=h,s.ready=!0,s.build()}),e.addClass(y).prependTo("body")))},q.build=function(){var i,e,h=this.$element,s=this.options;this.ready&&(this.built&&this.unbuild(),this.$cropper=i=t(c.TEMPLATE),h.addClass(C),this.$clone.removeClass(y).prependTo(i),this.$container=h.parent(),this.$container.append(i),this.$canvas=i.find(".cropper-canvas"),this.$cropBox=e=i.find(".cropper-cropbox"),this.$viewer=i.find(".cropper-viewer"),this.addListeners(),this.initPreview(),s.aspectRatio=U(S(s.aspectRatio))||NaN,s.autoCrop?(this.cropped=!0,s.modal&&this.$canvas.addClass(b)):e.addClass(C),s.background&&i.addClass(W),!s.highlight&&e.find(".cropper-face").addClass($),!s.guides&&e.find(".cropper-dashed").addClass(C),!s.movable&&e.find(".cropper-face").data(v,"move"),!s.resizable&&e.find(".cropper-line, .cropper-point").addClass(C),this.setDragMode(s.dragCrop?"crop":"move"),this.built=!0,this.render(),h.one(M,s.built).trigger(M))},q.unbuild=function(){this.built&&(this.built=!1,this.removeListeners(),this.$preview.empty(),this.$preview=null,this.$cropBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},t.extend(q,{render:function(){this.initContainer(),this.initImage(),this.initCropBox()},initContainer:function(){var t=this.$element,i=this.$container,e=this.$cropper,h=this.options;e.addClass(C),t.removeClass(C),e.css(this.container={width:N(i.width(),S(h.minContainerWidth)||350),height:N(i.height(),S(h.minContainerHeight)||150)}),t.addClass(C),e.removeClass(C)},initImage:function(){var i=this.container,e=this.image,h=e.aspectRatio,s=i.width,a=i.height,o=e.naturalWidth,r=e.naturalHeight,n=0,d=0;a*h>s?d=(a-(r=(o=s)/h))/2:n=(s-(o=(r=a)*h))/2,t.extend(e,{width:o,height:r,left:n,top:d}),this.defaultImage=t.extend({},e),this.renderImage()},renderImage:function(i){var e,h=this.options,s=this.image,a=s.width,o=s.height,r=s.rotate;r&&(e=d({width:a,height:o,degree:r})),t.extend(s,{rotatedWidth:e?e.width:s.width,rotatedHeight:e?e.height:s.height,rotatedLeft:e?s.left-(e.width-a)/2:s.left,rotatedTop:e?s.top-(e.height-o)/2:s.top}),this.$clone.css({width:a,height:o,marginLeft:s.left,marginTop:s.top,transform:n(r)}),i&&(this.preview(),t.isFunction(h.crop)&&h.crop.call(this.$element,this.getData()))},initCropBox:function(){var i=this.options,e=this.container,h=this.image,s=i.aspectRatio,a=e.width,o=e.height,r=U(S(i.minCropBoxWidth))||0,n=U(S(i.minCropBoxHeight))||0,d=U(S(i.autoCropArea))||.8,p={width:h.width,height:h.height,minWidth:r,minHeight:n,maxWidth:a,maxHeight:o};s&&(o*s>a?(p.height=p.width/s,p.maxHeight=a/s):(p.width=h.height*s,p.maxWidth=o*s),r?p.minHeight=p.minWidth/s:n&&(p.minWidth=p.minHeight*s)),p.minWidth=F(p.maxWidth,p.minWidth),p.minHeight=F(p.maxHeight,p.minHeight),p.width=N(p.minWidth,p.width*d),p.height=N(p.minHeight,p.height*d),p.left=(a-p.width)/2,p.top=(o-p.height)/2,p.oldLeft=p.left,p.oldTop=p.top,this.defaultCropBox=t.extend({},p),this.cropBox=p,this.cropped&&this.renderCropBox()},renderCropBox:function(){var i=this.options,e=this.container,h=this.$cropBox,s=this.cropBox;s.width>s.maxWidth?(s.width=s.maxWidth,s.left=s.oldLeft):s.width<s.minWidth&&(s.width=s.minWidth,s.left=s.oldLeft),s.height>s.maxHeight?(s.height=s.maxHeight,s.top=s.oldTop):s.height<s.minHeight&&(s.height=s.minHeight,s.top=s.oldTop),s.left=F(N(s.left,0),e.width-s.width),s.top=F(N(s.top,0),e.height-s.height),s.oldLeft=s.left,s.oldTop=s.top,i.movable&&h.find(".cropper-face").data(v,s.width===e.width&&s.height===e.height?"move":"all"),h.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.disabled||(this.preview(),t.isFunction(i.crop)&&i.crop.call(this.$element,this.getData()))}}),q.initPreview=function(){var i=this.url;this.$preview=t(this.options.preview),this.$viewer.html('<img src="'+i+'">'),this.$preview.each(function(){var e=t(this);e.data({width:e.width(),height:e.height()}).html('<img src="'+i+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;">')})},q.preview=function(){var i=this.image,e=this.cropBox,h=i.width,s=i.height,a=e.left-i.left,o=e.top-i.top,r=i.rotate;this.cropped&&!this.disabled&&(this.$viewer.find("img").css({width:h,height:s,marginLeft:-a,marginTop:-o,transform:n(r)}),this.$preview.each(function(){var i=t(this),d=i.data(),p=d.width/e.width,c=d.width,l=e.height*p;l>d.height&&(p=d.height/e.height,c=e.width*p,l=d.height),i.width(c).height(l).find("img").css({width:h*p,height:s*p,marginLeft:-a*p,marginTop:-o*p,transform:n(r)})}))},q.addListeners=function(){var i=this.options;this.$element.on(R,i.dragstart).on(E,i.dragmove).on(P,i.dragend),this.$cropper.on(I,t.proxy(this.dragstart,this)).on(z,t.proxy(this.dblclick,this)),i.zoomable&&i.mouseWheelZoom&&this.$cropper.on(X,t.proxy(this.wheel,this)),i.global?u.on(Y,this._dragmove=a(this.dragmove,this)).on(H,this._dragend=a(this.dragend,this)):this.$cropper.on(Y,t.proxy(this.dragmove,this)).on(H,t.proxy(this.dragend,this)),i.responsive&&f.on(L,this._resize=a(this.resize,this))},q.removeListeners=function(){var t=this.options;this.$element.off(R,t.dragstart).off(E,t.dragmove).off(P,t.dragend),this.$cropper.off(I,this.dragstart).off(z,this.dblclick),t.zoomable&&t.mouseWheelZoom&&this.$cropper.off(X,this.wheel),t.global?u.off(Y,this._dragmove).off(H,this._dragend):this.$cropper.off(Y,this.dragmove).off(H,this.dragend),t.responsive&&f.off(L,this._resize)},t.extend(q,{resize:function(){var i=this.$container,e=this.container;this.disabled||(i.width()!==e.width||i.height()!==e.height)&&(clearTimeout(this.resizing),this.resizing=setTimeout(t.proxy(function(){var t=this.getImageData(),i=this.getCropBoxData();this.render(),this.setImageData(t),this.setCropBoxData(i)},this),200))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(B)?"move":"crop")},wheel:function(t){var i=t.originalEvent,e=1;this.disabled||(t.preventDefault(),i.deltaY?e=i.deltaY>0?1:-1:i.wheelDelta?e=-i.wheelDelta/120:i.detail&&(e=i.detail>0?1:-1),this.zoom(.1*e))},dragstart:function(i){var e,h,s,a=this.options,o=i.originalEvent,r=o&&o.touches,n=i;if(!this.disabled){if(r){if((s=r.length)>1){if(!a.zoomable||!a.touchDragZoom||2!==s)return;n=r[1],this.startX2=n.pageX,this.startY2=n.pageY,e="zoom"}n=r[0]}if(e=e||t(n.target).data(v),x.test(e)){if(i.preventDefault(),h=t.Event(R),this.$element.trigger(h),h.isDefaultPrevented())return;this.directive=e,this.cropping=!1,this.startX=n.pageX,this.startY=n.pageY,"crop"===e&&(this.cropping=!0,this.$canvas.addClass(b))}}},dragmove:function(i){var e,h,s=this.options,a=i.originalEvent,o=a&&a.touches,r=i;if(!this.disabled){if(o){if((h=o.length)>1){if(!s.zoomable||!s.touchDragZoom||2!==h)return;r=o[1],this.endX2=r.pageX,this.endY2=r.pageY}r=o[0]}if(this.directive){if(i.preventDefault(),e=t.Event(E),this.$element.trigger(e),e.isDefaultPrevented())return;this.endX=r.pageX,this.endY=r.pageY,this.change()}}},dragend:function(i){var e;if(!this.disabled&&this.directive){if(i.preventDefault(),e=t.Event(P),this.$element.trigger(e),e.isDefaultPrevented())return;this.cropping&&(this.cropping=!1,this.$canvas.toggleClass(b,this.cropped&&this.options.modal)),this.directive=""}}}),t.extend(q,{reset:function(){this.cropped&&!this.disabled&&(this.image=t.extend({},this.defaultImage),this.renderImage(),this.cropBox=t.extend({},this.defaultCropBox),this.renderCropBox())},clear:function(){var t=this.cropBox;this.cropped&&!this.disabled&&(this.cropped=!1,t.left=0,t.top=0,t.width=0,t.height=0,this.renderCropBox(),this.$canvas.removeClass(b),this.$cropBox.addClass(C))},destroy:function(){var t=this.$element;this.ready||this.$clone.off("load").remove(),this.unbuild(),t.removeClass(C).removeData("cropper")},replace:function(i){var e,h,s=this,a=this.$element;!this.disabled&&i&&i!==this.url&&i!==a.attr("src")&&(a.is("img")?(a.attr("src",i),this.load()):a.is("canvas")&&j.canvas&&(e=a[0],h=e.getContext("2d"),t('<img src="'+i+'"">').one("load",function(){e.width=this.width,e.height=this.height,h.clearRect(0,0,e.width,e.height),h.drawImage(this,0,0),s.load()})))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(k))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(k))},move:function(t,e){var h=this.image;!this.disabled&&i(t)&&i(e)&&(h.left+=t,h.top+=e,this.renderImage(!0))},zoom:function(t){var i,e,h=this.image;(t=S(t))&&this.built&&!this.disabled&&this.options.zoomable&&(t=-1>=t?1/(1-t):1>=t?1+t:t,i=h.width*t,e=h.height*t,h.left-=(i-h.width)/2,h.top-=(e-h.height)/2,h.width=i,h.height=e,this.renderImage(!0),this.setDragMode("move"))},rotate:function(t){var i=this.image;0!==(t=S(t)||0)&&this.built&&!this.disabled&&this.options.rotatable&&(i.rotate=(i.rotate+t)%360,this.renderImage(!0))},getData:function(i){var e,h,s=this.cropBox,a=this.image,o=a.rotate;return this.built&&this.cropped?(h={x:s.left-(o?a.rotatedLeft:a.left),y:s.top-(o?a.rotatedTop:a.top),width:s.width,height:s.height},e=a.width/a.naturalWidth,t.each(h,function(t,s){s/=e,h[t]=i?O(s):s}),h.rotate=o):h={x:0,y:0,width:0,height:0,rotate:o},h},getImageData:function(i){var e=this.image,h={};return this.built&&t.extend(h,i?e:{left:e.left,top:e.top,width:e.width,height:e.height}),h},setImageData:function(e){var h=this.image;this.built&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(h.left=e.left),i(e.top)&&(h.top=e.top),i(e.width)?(h.width=e.width,h.height=h.width/h.aspectRatio):i(e.height)&&(h.height=e.height,h.width=h.height*h.aspectRatio),this.renderImage(!0))},getCropBoxData:function(){var t,i={};return this.cropped&&(i={left:(t=this.cropBox).left,top:t.top,width:t.width,height:t.height}),i},setCropBoxData:function(e){var h=this.cropBox,s=this.options.aspectRatio;this.cropped&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(h.left=e.left),i(e.top)&&(h.top=e.top),s?i(e.width)?(h.width=e.width,h.height=h.width/s):i(e.height)&&(h.height=e.height,h.width=h.height*s):(i(e.width)&&(h.width=e.width),i(e.height)&&(h.height=e.height)),this.renderCropBox())},getDataURL:function(h,s,a){var o,r,n,d,c,l,g,f,u,m,v;return this.cropped&&j.canvas&&(m=this.getData(),o=m.width,r=m.height,(g=t.isPlainObject(h))?(c=h.width||o,l=h.height||r):(a=s,s=h),n=g?c:o,d=g?l:r,(f=t("<canvas>")[0]).width=n,f.height=d,u=f.getContext("2d"),"image/jpeg"===s&&(u.fillStyle="#fff",u.fillRect(0,0,n,d)),u.drawImage.apply(u,function(){var t,i,e,h,s,a,n,d=p(this.$clone[0],this.image),l=d.width,f=d.height,u=[d],v=m.x,w=m.y;return-o>=v||v>l?v=t=e=s=0:0>=v?(e=-v,t=s=F(l,o+(v=0))):l>=v&&(e=0,t=s=F(o,l-v)),0>=t||-r>=w||w>f?w=i=h=a=0:0>=w?(h=-w,i=a=F(f,r+(w=0))):f>=w&&(h=0,i=a=F(r,f-w)),u.push(v,w,t,i),g&&(e/=n=o/c,h/=n,s/=n,a/=n),s>0&&a>0&&u.push(e,h,s,a),u}.call(this)),v=f.toDataURL.apply(f,function(){var t=[];return e(s)&&t.push(s),i(a)&&t.push(a),t}.call(this))),v||""},setAspectRatio:function(t){var i=this.options;this.disabled||h(t)||(i.aspectRatio=U(S(t))||NaN,this.built&&this.initCropBox())},setDragMode:function(t){var i=this.$canvas,e=!1,h=!1;if(this.ready&&!this.disabled){switch(t){case"crop":this.options.dragCrop?(e=!0,i.data(v,t)):h=!0;break;case"move":h=!0,i.data(v,t);break;default:i.removeData(v)}i.toggleClass(B,e).toggleClass(D,h)}}}),q.change=function(){var t,i,e,h,s,a,o,r=this.directive,n=this.image,d=this.container,p=d.width,c=d.height,l=this.cropBox,g=l.width,f=l.height,u=l.left,m=l.top,v=u+g,w=m+f,x=!0,b=this.options.aspectRatio,y={x:this.endX-this.startX,y:this.endY-this.startY};switch(b&&(y.X=y.y*b,y.Y=y.x/b),r){case"all":u+=y.x,m+=y.y;break;case"e":if(y.x>=0&&(v>=p||b&&(0>=m||w>=c))){x=!1;break}g+=y.x,b&&(f=g/b,m-=y.Y/2),0>g&&(r="w",g=0);break;case"n":if(y.y<=0&&(0>=m||b&&(0>=u||v>=p))){x=!1;break}f-=y.y,m+=y.y,b&&(g=f*b,u+=y.X/2),0>f&&(r="s",f=0);break;case"w":if(y.x<=0&&(0>=u||b&&(0>=m||w>=c))){x=!1;break}g-=y.x,u+=y.x,b&&(f=g/b,m+=y.Y/2),0>g&&(r="e",g=0);break;case"s":if(y.y>=0&&(w>=c||b&&(0>=u||v>=p))){x=!1;break}f+=y.y,b&&(g=f*b,u-=y.X/2),0>f&&(r="n",f=0);break;case"ne":if(b){if(y.y<=0&&(0>=m||v>=p)){x=!1;break}f-=y.y,m+=y.y,g=f*b}else y.x>=0?p>v?g+=y.x:y.y<=0&&0>=m&&(x=!1):g+=y.x,y.y<=0?m>0&&(f-=y.y,m+=y.y):(f-=y.y,m+=y.y);0>g&&0>f?(r="sw",f=0,g=0):0>g?(r="nw",g=0):0>f&&(r="se",f=0);break;case"nw":if(b){if(y.y<=0&&(0>=m||0>=u)){x=!1;break}f-=y.y,m+=y.y,g=f*b,u+=y.X}else y.x<=0?u>0?(g-=y.x,u+=y.x):y.y<=0&&0>=m&&(x=!1):(g-=y.x,u+=y.x),y.y<=0?m>0&&(f-=y.y,m+=y.y):(f-=y.y,m+=y.y);0>g&&0>f?(r="se",f=0,g=0):0>g?(r="ne",g=0):0>f&&(r="sw",f=0);break;case"sw":if(b){if(y.x<=0&&(0>=u||w>=c)){x=!1;break}g-=y.x,u+=y.x,f=g/b}else y.x<=0?u>0?(g-=y.x,u+=y.x):y.y>=0&&w>=c&&(x=!1):(g-=y.x,u+=y.x),y.y>=0?c>w&&(f+=y.y):f+=y.y;0>g&&0>f?(r="ne",f=0,g=0):0>g?(r="se",g=0):0>f&&(r="nw",f=0);break;case"se":if(b){if(y.x>=0&&(v>=p||w>=c)){x=!1;break}f=(g+=y.x)/b}else y.x>=0?p>v?g+=y.x:y.y>=0&&w>=c&&(x=!1):g+=y.x,y.y>=0?c>w&&(f+=y.y):f+=y.y;0>g&&0>f?(r="nw",f=0,g=0):0>g?(r="sw",g=0):0>f&&(r="ne",f=0);break;case"move":n.left+=y.x,n.top+=y.y,this.renderImage(!0),x=!1;break;case"zoom":this.zoom((i=n.width,e=n.height,h=U(this.startX-this.startX2),s=U(this.startY-this.startY2),a=U(this.endX-this.endX2),o=U(this.endY-this.endY2),(A(a*a+o*o)-A(h*h+s*s))/A(i*i+e*e))),this.endX2=this.startX2,this.endY2=this.startY2,x=!1;break;case"crop":y.x&&y.y&&(t=this.$cropper.offset(),u=this.startX-t.left,m=this.startY-t.top,g=l.minWidth,f=l.minHeight,y.x>0?y.y>0?r="se":(r="ne",m-=f):y.y>0?(r="sw",u-=g):(r="nw",u-=g,m-=f),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(C)))}x&&(l.width=g,l.height=f,l.left=u,l.top=m,this.directive=r,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},t.extend(c.prototype,q),c.DEFAULTS={aspectRatio:NaN,autoCropArea:.8,crop:null,preview:"",global:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,highlight:!0,background:!0,autoCrop:!0,dragCrop:!0,movable:!0,resizable:!0,rotatable:!0,zoomable:!0,touchDragZoom:!0,mouseWheelZoom:!0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:300,minContainerHeight:150,build:null,built:null,dragstart:null,dragmove:null,dragend:null},c.setDefaults=function(i){t.extend(c.DEFAULTS,i)},c.TEMPLATE=(l='<0 6="5-container"><0 6="5-canvas"></0><0 6="5-cropbox"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',g=(g="div,span,directive,data,point,cropper,class,line,dashed").split(","),l.replace(/\d+/g,function(t){return g[t]})),c.other=t.fn.cropper,t.fn.cropper=function(i){var e,a=s(arguments,1);return this.each(function(){var h,s=t(this),o=s.data("cropper");o||s.data("cropper",o=new c(this,i)),"string"==typeof i&&t.isFunction(h=o[i])&&(e=h.apply(o,a))}),h(e)?this:e},t.fn.cropper.Constructor=c,t.fn.cropper.setDefaults=c.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=c.other,this}});